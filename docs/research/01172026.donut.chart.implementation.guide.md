# Donut Chart Implementation Guide

**Date:** January 17, 2026  
**Reference:** Greenery/src/components/home  
**Library:** vue-chartjs (Chart.js wrapper for Vue)

---

## Overview

The donut chart in Greenery displays cryptocurrency portfolio allocation and market indices. It features:

- Dynamic data binding with reactive updates
- Center text showing totals and asset counts
- Hover interactions that update the center text
- IPC communication for cross-component state updates

---

## Architecture

```
views/Home.vue
  └── components/home/Index.vue (data logic + rendering)
        ├── <doughnut-chart> (chart component)
        └── <metrics> (optional metrics display)
              
components/home/DoughnutChart.vue (vue-chartjs wrapper)
  └── extends vue-chartjs Doughnut
```

---

## Key Files

### 1. DoughnutChart.vue - The Chart Component

**Location:** `Greenery/src/components/home/DoughnutChart.vue`

```vue
<script>
import { Doughnut, mixins } from 'vue-chartjs'

export default {
  name: 'DougnutChart',
  extends: Doughnut,
  mixins: [mixins.reactiveProp],
  props: ['chartData', 'options'],
  
  watch: {
    options(newVal) {
      if (newVal !== null) {
        const chart = this.$data._chart
        chart.update()
        this.addPlugin({
          id: 'myUpdateEventCatcher',
          beforeEvent(chart, args) {
            var event = args.type
            if (event === 'mousemove' || event === 'mouseout') {
              window.ipcRenderer.send('updateDonutCenter', 'total')
            }
          }
        })
        this.renderChart(this.chartData, this.options)
      }
    }
  },
  
  mounted() {
    this.addPlugin({
      id: 'myEventCatcher',
      beforeEvent(chart, args) {
        var event = args.type
        if (event === 'mousemove' || event === 'mouseout') {
          window.ipcRenderer.send('updateDonutCenter', 'total')
        }
      }
    })
    this.renderChart(this.chartData, this.options)
  }
}
</script>
```

**Key Points:**
- Extends `Doughnut` from `vue-chartjs`
- Uses `mixins.reactiveProp` for reactive data updates
- Accepts `chartData` and `options` as props
- Registers Chart.js plugins for event handling
- Uses IPC to communicate hover events

---

### 2. Index.vue - Data Logic and Template

**Location:** `Greenery/src/components/home/Index.vue`

#### Template Structure

```vue
<template>
  <div class="d-block d-xl-flex align-items-xl-center h-full">
    <!-- Doughnut Chart -->
    <div class="mh-100">
      <metrics v-if="!portfolioView" :cryptos="filteredCrypto" />
      <div class="chart-wrapper">
        <doughnut-chart
          id="donutChart"
          :chartData="dataCollection"
          :options="dataOptions"
        ></doughnut-chart>
        
        <!-- Center Text Overlay -->
        <div id="chartjs-tooltip">
          <div>
            <p class="flex justify-center items-center font-semibold">
              {{ cntrDonutTxtLineOne }}
            </p>
            <p class="flex justify-center items-center text-lg mt-1">
              {{ cntrDonutTxtLineTwo }}
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Table Container -->
    <div class="overflow-auto table-container">
      <!-- Cryptocurrency table data -->
    </div>
  </div>
</template>
```

#### Data Properties

```javascript
data() {
  return {
    dataCollection: null,   // Chart.js data object
    dataOptions: null,      // Chart.js options object
    cntrDonutTxtLineOne: '', // Center text line 1 (e.g., "$10,000")
    cntrDonutTxtLineTwo: '', // Center text line 2 (e.g., "5 Assets")
    // ... other properties
  }
}
```

#### Chart Data Population

The `fillDonutData()` method builds the chart configuration:

```javascript
fillDonutData() {
  // Arrays to build chart data
  const labelArr = []          // Coin symbols
  const labelBKColorArr = []   // Background colors
  const labelCoinCapArr = []   // Market cap values
  
  // Iterate through filtered cryptocurrencies
  this.filteredCrypto.forEach((crypto) => {
    labelArr.push(crypto.symbol)
    labelBKColorArr.push(crypto.color)
    labelCoinCapArr.push(crypto.marketCap)
  })
  
  // Set center text
  this.setCenterDonutText(formattedSum, totalAssets)
  
  // Build Chart.js data object
  this.dataCollection = {
    labels: labelArr,
    datasets: [{
      borderWidth: 0,
      borderColor: 'black',
      backgroundColor: labelBKColorArr,
      donutData: walletDonutData,
      data: labelCoinCapArr
    }]
  }
  
  // Build Chart.js options object
  this.dataOptions = {
    title: {
      display: false,
      text: this.selectedTab
    },
    legend: {
      display: false
    },
    events: ['mousemove', 'mouseout', 'click', 'touchstart', 'touchmove'],
    hover: {
      mode: 'nearest',
      intersect: true,
      onHover: (event, chartElement) => {
        if (chartElement.length) {
          const hoveredCoinSymbol = chartElement[0]._view.label
          window.ipcRenderer.send('updateDonutCenter', hoveredCoinSymbol)
        }
      }
    },
    elements: {
      center: {
        text: centerTextValue,
        color: '#FFF',
        fontStyle: 'Arial',
        sizePadding: 20,
        minFontSize: 25,
        lineHeight: 25
      }
    },
    responsive: true,
    maintainAspectRatio: true,
    cutoutPercentage: 85,  // Creates the "donut hole"
    borderAlign: 'inner',
    animation: {
      animateRotate: true,
      animateScale: false
    },
    tooltips: {
      callbacks: {
        label: function(tooltipItem, data) {
          const label = data.labels[tooltipItem.index]
          const value = data.datasets[0].data[tooltipItem.index]
          // Calculate percentage
          const sum = data.datasets[0].data.reduce((a, b) => a + b, 0)
          const percentage = ((value / sum) * 100).toFixed(0)
          return `${label}: ${percentage}%`
        }
      }
    }
  }
}
```

---

## Styling

```scss
.chart-wrapper {
  width: 300px;
  max-height: 300px;
  position: relative;
  margin: auto;
  padding: 25px;

  @media (min-width: 1200px) {
    width: 400px;
    max-height: 400px;
  }

  @media (min-width: 1500px) {
    width: 500px;
    max-height: 500px;
  }

  #donutChart {
    position: relative;
    z-index: 10;
  }
  
  #chartjs-tooltip {
    left: 0;
    top: 0;
    right: 0;
    display: flex;
    justify-content: center;
    position: absolute;
    z-index: 0;
    height: 100%;
    align-items: center;
    color: #000;
    font-size: 20px;
    font-weight: 800;
  }
}
```

**Key CSS Concepts:**
- Chart wrapper uses relative positioning
- Center text uses absolute positioning with flexbox centering
- Z-index layering: chart on top (10), text behind (0)
- Responsive breakpoints for different screen sizes

---

## Data Flow

```
1. Component Mount
   └── fillDonutData() called
   
2. fillDonutData()
   ├── Filter cryptocurrencies based on selected tab
   ├── Build labelArr, labelBKColorArr, labelCoinCapArr
   ├── Calculate totals and percentages
   ├── Set cntrDonutTxtLineOne and cntrDonutTxtLineTwo
   └── Assign dataCollection and dataOptions

3. Vue Reactivity
   └── DoughnutChart receives updated props
       └── Watch triggers renderChart()

4. User Hover
   ├── Chart.js hover event fires
   ├── onHover callback extracts coin symbol
   ├── IPC sends 'updateDonutCenter' message
   └── Electron main process can update center text
```

---

## Tab-Based Filtering

The chart displays different data based on the selected tab:

```javascript
computed: {
  filteredCrypto() {
    if (this.portfolioView) {
      // Portfolio: Show user's wallet holdings
      return this.getWalletData
    } else {
      // Indices: Filter by consensus type or exchange
      return this.coinsInfo.filter(coin => {
        switch (this.selectedTab) {
          case 'proof of work':
            return coin.consensusType === 'PoW'
          case 'proof of stake':
            return coin.consensusType === 'PoS'
          case 'coinbase (NY)':
            return coin.exchanges.includes('coinbase')
          case 'gemini (NY)':
            return coin.exchanges.includes('gemini')
          case 'storage':
            return coin.category === 'storage'
          default:
            return true
        }
      })
    }
  }
}
```

---

## Dependencies

### NPM Packages

```json
{
  "dependencies": {
    "vue-chartjs": "^3.5.1",
    "chart.js": "^2.9.4"
  }
}
```

### Imports in Index.vue

```javascript
import DoughnutChart from './DoughnutChart.vue'
import Metrics from './Metrics.vue'
import { mapState, mapGetters } from 'vuex'
```

---

## IPC Communication

The chart uses Electron IPC for hover state synchronization:

```javascript
// In DoughnutChart.vue - sending
window.ipcRenderer.send('updateDonutCenter', hoveredCoinSymbol)

// In Index.vue - hover callback
onHover: (event, chartElement) => {
  if (chartElement.length) {
    const hoveredCoinSymbol = chartElement[0]._view.label
    window.ipcRenderer.send('updateDonutCenter', hoveredCoinSymbol)
  }
}
```

This allows the main process to coordinate updates across components or windows.

---

## Implementation Checklist for New Projects

1. **Install Dependencies**
   ```bash
   npm install vue-chartjs chart.js
   ```

2. **Create Chart Component**
   - Extend `Doughnut` from `vue-chartjs`
   - Use `reactiveProp` mixin for data binding
   - Register plugins for event handling

3. **Create Parent Component**
   - Define `dataCollection` and `dataOptions` in data
   - Create method to populate chart data
   - Add computed properties for filtered data

4. **Style the Chart**
   - Use relative positioning on wrapper
   - Absolute positioning for center text
   - Responsive breakpoints for sizing

5. **Handle Reactivity**
   - Watch for tab/filter changes
   - Call data population method on change
   - Vue-chartjs handles re-rendering

---

## Common Customizations

### Change Donut Hole Size
```javascript
cutoutPercentage: 85  // 0-100, higher = bigger hole
```

### Disable Animation
```javascript
animation: {
  animateRotate: false,
  animateScale: false
}
```

### Custom Colors
```javascript
backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
```

### Custom Tooltips
```javascript
tooltips: {
  enabled: true,
  callbacks: {
    label: (tooltipItem, data) => {
      return `Custom: ${data.labels[tooltipItem.index]}`
    }
  }
}
```

---

## References

- [vue-chartjs Documentation](https://vue-chartjs.org/)
- [Chart.js Doughnut/Pie Charts](https://www.chartjs.org/docs/latest/charts/doughnut.html)
- [Chart.js Plugins](https://www.chartjs.org/docs/latest/developers/plugins.html)

