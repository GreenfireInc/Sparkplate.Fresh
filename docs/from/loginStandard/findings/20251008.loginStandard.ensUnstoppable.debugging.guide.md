# Domain Resolution Debugging Guide

## Issue Reported
Domain names (ENS/Unstoppable Domains) not showing when importing private keys with associated human-readable addresses.

## Improvements Made (October 8, 2025)

### Enhanced Logging
Added comprehensive logging throughout the domain resolution pipeline to help diagnose issues:

1. **`src/components/domains/ens.ts`**
   - Added detailed logging for ENS reverse lookup process
   - Logs provider initialization
   - Logs success/failure states
   - Logs error details with stack traces

2. **`src/components/domains/uns.ts`**
   - Added logging for Unstoppable Domains attempts
   - Clarified that reverse lookup is not supported by UNS API
   - Removed invalid cache options

3. **`src/components/domains/index.ts`**
   - Added step-by-step logging for combined resolution
   - Shows which services are being tried
   - Logs final results

### Console Output Guide

When importing a private key, you should see logs like:

```
ğŸ” Attempting to resolve domain name for address: 0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045
ğŸ” [Domain Resolution] Starting reverse lookup for ETH address: 0xd8dA...
ğŸ” [Domain Resolution] Checking ENS for Ethereum address...
ğŸ” [ENS] Starting reverse lookup for address: 0xd8dA...
ğŸ”— [ENS] Provider initialized, performing lookupAddress...
```

**Success case:**
```
âœ… [ENS] Successfully resolved domain: vitalik.eth
âœ… [Domain Resolution] ENS domain found: vitalik.eth
```

**Not found case:**
```
â„¹ï¸ [ENS] No domain found for address: 0x...
â„¹ï¸ [Domain Resolution] No ENS domain found
ğŸ” [Domain Resolution] Checking Unstoppable Domains...
âš ï¸ [UNS] Reverse resolution for Unstoppable Domains is not fully supported yet
â„¹ï¸ [Domain Resolution] No domain found for address 0x...
```

**Error case:**
```
âŒ [ENS] Reverse lookup error for 0x...: Error message
âŒ [ENS] Error message: Network error
âŒ [ENS] Error stack: [stack trace]
```

## Known Limitations

### Unstoppable Domains
- **Reverse lookup NOT supported**: The Unstoppable Domains API does not provide reverse lookup functionality (address â†’ domain)
- Only forward lookup works (domain â†’ address)
- This means UNS domains will NOT be displayed automatically when importing keys

### ENS (Ethereum Name Service)
- **Only works for Ethereum mainnet**
- Requires valid Infura connection
- May fail due to:
  - Network connectivity issues
  - Rate limiting (if using public Infura key)
  - Address doesn't have a reverse record set
  - ENS domain owner hasn't configured reverse resolution

## Troubleshooting Steps

### 1. Check Browser Console
Open Developer Tools (F12) and look for the domain resolution logs.

### 2. Verify Network
- Ensure you're connected to the internet
- Check if Infura is accessible: https://mainnet.infura.io/v3/

### 3. Check if Address Actually Has ENS
Not all Ethereum addresses have ENS domains. To verify:
1. Go to https://app.ens.domains/
2. Search for the address
3. Check if "Primary Name" is set

### 4. Verify Reverse Record
ENS reverse records must be explicitly set by the domain owner:
- Owner must call `setName()` on the ENS Reverse Registrar
- This is a separate transaction from registering the domain
- Many addresses don't have reverse records configured

### 5. Check Infura Rate Limits
If using the public fallback key, you may hit rate limits:
- Set custom `VITE_INFURA_PROJECT_ID` in environment
- Check Infura dashboard for rate limit status

### 6. Network-Specific Issues
Domain resolution only works for:
- **ENS**: Ethereum (ETH) addresses only
- **UNS**: Forward resolution only (not implemented for reverse)

## Testing

### Test with Known ENS Address
Use Vitalik's address (has ENS reverse record):
```
Address: 0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045
Expected domain: vitalik.eth
```

### Test with Address Without ENS
Create a fresh wallet or use an address known to not have ENS:
```
Expected: No domain shown (silent, not an error)
```

### Test with Non-Ethereum Network
Try with BTC, SOL, etc.:
```
Expected: Skips ENS, tries UNS (which returns null)
```

## Code Flow

```
TemporaryKeyModal.handleDerive()
        â†“
resolveDomainForAddress(address, ticker)
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Is ETH?        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Yes
         â†“
ensResolver.resolveDomainForAddress()
         â†“
provider.lookupAddress()  â† Calls Infura
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Domain found?   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    Yes  â”‚       â”‚ No
         â†“       â†“
    Return    Try UNS
    domain    (returns null)
```

## Expected Behavior

âœ… **Working correctly if:**
- Address has ENS reverse record â†’ Shows ENS domain
- Address has no domain â†’ Continues without error
- Network error â†’ Logs error, continues without blocking

âŒ **Not working if:**
- No logs appear in console (resolution not being called)
- Error logs but no domain shown (investigate specific error)
- Domain exists but not shown (check reverse record configuration)

## Next Steps if Still Not Working

1. **Share console logs**: Copy all domain resolution logs from browser console
2. **Test address**: Share the address you're testing with (to verify it has ENS)
3. **Network**: Confirm which cryptocurrency network you're using
4. **Environment**: Check if `VITE_INFURA_PROJECT_ID` is set

## Additional Notes

- Domain resolution is **non-blocking** - wallet import will succeed even if resolution fails
- Resolution happens **after** address derivation, not before
- Silent failures are intentional - we don't want to bother users if domain lookup fails
- Toast notifications only show when domain IS found successfully

