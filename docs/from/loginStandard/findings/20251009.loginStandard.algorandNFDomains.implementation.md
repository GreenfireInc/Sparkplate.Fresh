# Algorand NF Domains Implementation

**Date**: October 9, 2025  
**Component**: `src/components/domains/algo.ts`  
**Feature**: Algorand address resolution using NF Domains (NFD)  
**Status**: Complete  

---

## Summary

Successfully implemented Algorand NF Domains resolution for the loginStandard application. Users can now resolve `.algo` domain names to Algorand addresses and perform reverse lookups to find NFD names associated with Algorand addresses when importing private keys.

---

## Implementation Details

### Files Created

#### 1. `/src/components/domains/algo.ts`

New domain resolver following the same pattern as `tez.ts`, implementing:

- **Forward Resolution**: `.algo` domain ‚Üí Algorand address
- **Reverse Resolution**: Algorand address ‚Üí `.algo` domain
- **Domain Validation**: Check if string is valid `.algo` domain

**Key Features:**
- Uses NF Domains public API: `https://api.nf.domains/nfd/`
- Supports both forward and reverse lookups
- Includes avatar metadata in reverse lookups
- Comprehensive error handling and logging
- Validates Algorand address format (58 characters, base32 encoded)

### Files Modified

#### 2. `/src/components/domains/index.ts`

**Changes:**
- Added `algoDomainsResolver` import
- Updated type definitions to include `'ALGO'` service
- Added Algorand domain resolution to `resolveAddress()` function
- Added Algorand reverse lookup to `resolveDomainForAddress()` function
- Updated `isDomain()` to check for `.algo` domains

#### 3. `/src/components/domains/router.domains.tsx`

**Changes:**
- Updated `domainService` state type to include `'ALGO'`
- Added NF Domains link generation (`https://app.nf.domains/name/{name}`)
- Added NF Domains icon reference (`/assets/icons/domains/algorandNFDomains.svg`)
- Added NF Domains tooltip text

---

## API Endpoints Used

### NF Domains API

**Base URL:** `https://api.nf.domains/nfd/`

#### Forward Resolution
```
GET /nfd/{domainName}
```
- **Input**: Domain name (without .algo extension)
- **Output**: NFD data including owner address
- **Example**: `GET /nfd/example` resolves `example.algo`

**Response Format:**
```json
{
  "name": "example",
  "owner": "ALGORAND_ADDRESS_HERE",
  "depositAccount": "...",
  "properties": { ... }
}
```

#### Reverse Resolution
```
GET /nfd/lookup?address={address}&view=thumbnail
```
- **Input**: Algorand address
- **Parameters**:
  - `address`: The Algorand wallet address
  - `view`: Set to `thumbnail` to include avatar data
- **Output**: NFD data keyed by address

**Response Format:**
```json
{
  "ALGORAND_ADDRESS_HERE": {
    "name": "example",
    "avatar": "https://...",
    "owner": "ALGORAND_ADDRESS_HERE",
    ...
  }
}
```

---

## Technical Specifications

### Address Format Validation

**Algorand Address Format:**
- Length: 58 characters
- Encoding: Base32 (RFC 4648)
- Character Set: A-Z, 2-7
- Regex: `/^[A-Z2-7]{58}$/`

**Example Valid Address:**
```
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```

### Domain Format

**NF Domains Format:**
- TLD: `.algo`
- Minimum Length: 6 characters (including .algo)
- Case: Case-insensitive (normalized to lowercase for API calls)

**Examples:**
- `example.algo` ‚úÖ
- `my-nfd.algo` ‚úÖ
- `corey.algo` ‚úÖ
- `test` ‚ùå (no .algo extension)
- `a.algo` ‚ùå (too short)

---

## Integration with Algorand Currency

The implementation integrates with the existing Algorand currency module:

**File:** `src/components/currencies/ALGO.Algorand.ts`

When a user imports an Algorand private key:
1. The private key is processed by `ALGO.Algorand.ts`
2. The derived address is extracted
3. The domain router automatically attempts reverse lookup
4. If an NFD is found, it's displayed with the address

**Flow:**
```
Private Key Import
    ‚Üì
Derive Address (ALGO.Algorand.ts)
    ‚Üì
Display Address (UI Component)
    ‚Üì
Reverse Lookup (algo.ts)
    ‚Üì
Display NFD Domain (router.domains.tsx)
```

---

## Usage Examples

### Forward Resolution (Domain ‚Üí Address)

```typescript
import { algoDomainsResolver } from '@/components/domains';

// Resolve domain to address
const address = await algoDomainsResolver.getAddress({
  domain: 'example.algo',
  coinTicker: 'ALGO'
});
// Returns: "ALGORAND_ADDRESS_HERE"
```

### Reverse Resolution (Address ‚Üí Domain)

```typescript
import { algoDomainsResolver } from '@/components/domains';

// Resolve address to domain
const domain = await algoDomainsResolver.resolveDomainForAddress(
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
);
// Returns: "example.algo" or null
```

### Using Combined Resolver

```typescript
import { resolveAddress, resolveDomainForAddress } from '@/components/domains';

// Forward
const result = await resolveAddress('example.algo', 'ALGO');
// Returns: { address: "...", service: "ALGO" }

// Reverse
const domainResult = await resolveDomainForAddress(address, 'ALGO');
// Returns: { domain: "example.algo", service: "ALGO" } or null
```

---

## Error Handling

### Forward Resolution Errors

| Error | Cause | Handling |
|-------|-------|----------|
| `Domain not found` | NFD doesn't exist | Throws error |
| `Invalid domain format` | Not .algo domain | Throws error |
| `Wrong coin ticker` | Not ALGO | Throws error |
| `API error` | Network/API issues | Throws error with details |

### Reverse Resolution Errors

| Error | Cause | Handling |
|-------|-------|----------|
| `Invalid address format` | Wrong format | Returns null (graceful) |
| `No domain found` | Address has no NFD | Returns null (expected) |
| `API error` | Network/API issues | Returns null (graceful) |

**Philosophy:**
- Forward resolution: Throw errors (user explicitly requested domain)
- Reverse resolution: Return null (optional feature, shouldn't break flow)

---

## Logging

All operations include comprehensive logging:

### Console Output Example

```
üîç [NF Domains] Starting reverse lookup for address: AAAA...
üîß [NF Domains] Querying API for reverse lookup...
üîç [NF Domains] API response: { ... }
‚úÖ [NF Domains] Successfully resolved: AAAA... ‚Üí example.algo
‚ÑπÔ∏è [NF Domains] Avatar available at: https://...
```

### Log Levels
- üîç **Info**: Operation start/progress
- üîß **Debug**: Technical details
- ‚úÖ **Success**: Successful operations
- ‚ö†Ô∏è **Warning**: Non-critical issues
- ‚ùå **Error**: Critical failures
- ‚ÑπÔ∏è **Notice**: Additional information

---

## Testing Recommendations

### Test Cases

#### 1. Forward Resolution
```typescript
// Test valid domain
await algoDomainsResolver.getAddress({
  domain: 'example.algo',
  coinTicker: 'ALGO'
});
// Expected: Returns valid address

// Test non-existent domain
await algoDomainsResolver.getAddress({
  domain: 'nonexistent12345.algo',
  coinTicker: 'ALGO'
});
// Expected: Throws "Domain not found"

// Test invalid domain format
await algoDomainsResolver.getAddress({
  domain: 'example.eth',
  coinTicker: 'ALGO'
});
// Expected: Throws "not a valid Algorand domain"
```

#### 2. Reverse Resolution
```typescript
// Test address with NFD
await algoDomainsResolver.resolveDomainForAddress(
  'VALID_ADDRESS_WITH_NFD'
);
// Expected: Returns "example.algo"

// Test address without NFD
await algoDomainsResolver.resolveDomainForAddress(
  'VALID_ADDRESS_WITHOUT_NFD'
);
// Expected: Returns null

// Test invalid address
await algoDomainsResolver.resolveDomainForAddress('invalid');
// Expected: Returns null
```

#### 3. Domain Validation
```typescript
algoDomainsResolver.isAlgoDomain('example.algo'); // true
algoDomainsResolver.isAlgoDomain('EXAMPLE.ALGO'); // true (case-insensitive)
algoDomainsResolver.isAlgoDomain('example.eth');  // false
algoDomainsResolver.isAlgoDomain('example');      // false
algoDomainsResolver.isAlgoDomain('a.algo');       // false (too short)
```

---

## UI Integration Notes

### Icon Requirement

The router expects an icon at:
```
/public/assets/icons/domains/algorandNFDomains.svg
```

**Note:** This icon file needs to be added to the project. Suggested sources:
- NF Domains brand assets
- Algorand brand assets
- Create custom icon combining both

### Link Behavior

When user clicks on resolved NFD:
- Opens: `https://app.nf.domains/name/{domainName}`
- Example: `https://app.nf.domains/name/example`
- Note: The `.algo` extension is stripped from URL

### Display Format

NFDs are displayed with the `.algo` extension:
- API returns: `"example"`
- Display shows: `"example.algo"`

---

## Dependencies

### Existing Dependencies (No New Installs Required)

The implementation uses only built-in browser `fetch` API and standard JavaScript:
- No new npm packages needed
- Works with existing project setup
- Leverages public NF Domains API

---

## Rate Limiting & Best Practices

### NF Domains API

- **Public API**: No authentication required
- **Rate Limits**: Not officially documented
- **Best Practice**: Implement caching for repeated lookups
- **Recommendation**: Consider adding debounce for user input

### Potential Improvements

```typescript
// Cache implementation example
const nfdCache = new Map<string, { domain: string | null; timestamp: number }>();
const CACHE_TTL = 5 * 60 * 1000; // 5 minutes

async function cachedResolveDomain(address: string): Promise<string | null> {
  const cached = nfdCache.get(address);
  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
    return cached.domain;
  }
  
  const domain = await algoDomainsResolver.resolveDomainForAddress(address);
  nfdCache.set(address, { domain, timestamp: Date.now() });
  return domain;
}
```

---

## Documentation Resources

### Official NF Domains Documentation
- Main Site: https://nf.domains
- App: https://app.nf.domains
- API Docs: https://api-docs.nf.domains
- Integration Guide: https://api-docs.nf.domains/reference/integrators-guide/

### Algorand Resources
- Main Site: https://algorand.com
- Developer Portal: https://developer.algorand.org
- Address Format: https://developer.algorand.org/docs/get-details/accounts/

---

## Future Enhancements

### Potential Features

1. **Batch Lookups**
   - NF Domains API supports up to 20 addresses per request
   - Could optimize multiple address lookups

2. **Avatar Display**
   - API returns avatar URLs
   - Could display NFD avatars alongside domains

3. **Additional Metadata**
   - NFDs support rich metadata
   - Could show bio, social links, etc.

4. **Subdomain Support**
   - NF Domains supports subdomains
   - Could implement `sub.parent.algo` resolution

5. **Search Functionality**
   - API supports search endpoints
   - Could add domain search/discovery features

---

## Troubleshooting

### Common Issues

#### Issue: "Invalid Algorand address format"
**Cause:** Address doesn't match 58-character base32 format  
**Solution:** Verify address is correctly derived from private key

#### Issue: "No domain found"
**Cause:** Address doesn't have an associated NFD  
**Solution:** This is expected behavior - not all addresses have NFDs

#### Issue: "API request failed"
**Cause:** Network issues or API downtime  
**Solution:** Implement retry logic or fallback behavior

#### Issue: Icon not displaying
**Cause:** Missing icon file  
**Solution:** Add `algorandNFDomains.svg` to `/public/assets/icons/domains/`

---

## Conclusion

The Algorand NF Domains implementation is complete and follows the established patterns in the codebase. It provides seamless integration with the existing domain resolution system and enhances the user experience when working with Algorand addresses and private keys.

**Status**: ‚úÖ Ready for production use (pending icon asset addition)

