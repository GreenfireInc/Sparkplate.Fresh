# Polkadot Curve Selection Implementation Methodology

**Date:** October 1, 2025  
**Project:** loginStandard  
**Topic:** Implementing Cryptographic Curve Selection for Polkadot Private Key Import  
**Keywords:** Polkadot, ed25519, sr25519, ecdsa, UI/UX, curve selection, Exodus, methodology  
**Status:** ğŸ“‹ **METHODOLOGY**

---

## Executive Summary

This document provides a comprehensive methodology for implementing a cryptographic curve selection feature in the Polkadot import workflow. The feature allows users to explicitly choose between **ed25519**, **sr25519**, and **ecdsa** schemes when importing private keys, addressing the fundamental issue that the same private key produces different addresses when derived using different cryptographic curves.

### Problem Statement

Based on extensive analysis documented in:
- `10012025.loginStandard.Exodus.polkadot.implementation.analysis.md`
- `10012025.loginStandard.Polkadot.addressGeneration.discrepancy.analysis.md`
- `10012025.loginStandard.Polkadot.wallet.implementations.analysis.md`

We identified that:
1. **Same private key â†’ Different addresses** depending on the curve used
2. **Exodus uses ed25519** for raw private key imports
3. **Standard Polkadot wallets use sr25519** for keystore operations
4. **Users need explicit control** over which derivation method is used

### Solution Overview

Implement a user-facing curve selection control that:
- âœ… Allows explicit ed25519/sr25519/ecdsa selection
- âœ… Shows real-time address preview for each curve
- âœ… Provides clear guidance on which curve to use
- âœ… Integrates seamlessly with existing `Importing.tsx` component
- âœ… Follows established patterns from other wallet implementations

---

## Table of Contents

1. [Background & Research](#background--research)
2. [Architecture Design](#architecture-design)
3. [Implementation Plan](#implementation-plan)
4. [Component Specifications](#component-specifications)
5. [Code Examples](#code-examples)
6. [Testing Strategy](#testing-strategy)
7. [User Experience Design](#user-experience-design)
8. [Security Considerations](#security-considerations)
9. [References](#references)

---

## Background & Research

### Current Implementation Analysis

#### Existing Router Logic (`router.DOT.Polkadot.ts`)

**Current Behavior:**
```typescript
// Automatic detection based on known public keys
export function detectInputType(input: string): 'keystore_public_key' | 'raw_private_key' {
  const knownKeystorePublicKeys = [
    '180c4c67b5ebd43bf08b6f56623ea1b642a1c2374eafb255fff180f364f19178',
    '3e62924874571ed00afc7f7331fadcb7a4382f5b10584f1f98c571685908c347',
    '487478000e21b67b645b9dbfff4e7b40f8e32e8fce77d755baa13d96c0253759'
  ];

  if (knownKeystorePublicKeys.includes(cleanInput)) {
    return 'keystore_public_key'; // Routes to sr25519
  }
  
  return 'raw_private_key'; // Routes to ed25519 (default)
}
```

**Limitation:** 
- No user control over curve selection
- Relies on hardcoded list of known public keys
- Cannot handle new/unknown keystores
- Users importing from other wallets may get wrong addresses

### Industry Standard Implementations

#### Talisman Wallet Pattern

```typescript
// From: talisman-dev/packages/crypto/src/derivation/
export type CurveType = 'sr25519' | 'ed25519' | 'ecdsa'

export const derive = (
  seed: Uint8Array, 
  derivationPath: string, 
  type: CurveType = 'sr25519' // Default to sr25519
): Keypair => {
  switch(type) {
    case 'sr25519': return deriveSr25519(seed, derivationPath)
    case 'ed25519': return deriveEd25519(seed, derivationPath)
    case 'ecdsa': return deriveEcdsa(seed, derivationPath)
    default: throw new Error(`Unknown curve type: ${type}`)
  }
}
```

**Key Insight:** Talisman uses explicit curve selection with sr25519 as default.

#### SubWallet Pattern

```typescript
// From: SubWallet-Extension-master/packages/extension-base/
const cryptoType = Array.isArray(json.encoding.content) 
  ? json.encoding.content[1] 
  : 'ed25519'; // Fallback default

const pair = createPair({
  toSS58: this.encodeAddress, 
  type: cryptoType as KeypairType
}, { publicKey: this.decodeAddress(json.address, true) }, 
   json.meta, 
   hexToU8a(json.encoded), 
   encType
);
```

**Key Insight:** SubWallet reads curve type from keystore metadata when available.

#### Nova Spektr Pattern

```typescript
// From: nova-spektr-dev/src/renderer/entities/wallet/
interface AccountData {
  cryptoType: 'sr25519' | 'ed25519' | 'ecdsa' | 'ethereum'
  // ... other fields
}

// Explicit storage of crypto type with account metadata
```

**Key Insight:** Nova Spektr stores curve type alongside account data.

---

## Architecture Design

### Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Importing.tsx                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Input Field (Private Key)                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CurveSelector Component (NEW)                       â”‚  â”‚
â”‚  â”‚  â€¢ Dropdown or Toggle Group                          â”‚  â”‚
â”‚  â”‚  â€¢ Options: ed25519 | sr25519 | ecdsa               â”‚  â”‚
â”‚  â”‚  â€¢ Guidance tooltips                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AddressPreview Component (NEW)                      â”‚  â”‚
â”‚  â”‚  â€¢ Shows derived address for selected curve          â”‚  â”‚
â”‚  â”‚  â€¢ Live updates as user types                        â”‚  â”‚
â”‚  â”‚  â€¢ Expandable to show all 3 curve results           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DOT.Polkadot.CurveSelector.ts (NEW)              â”‚
â”‚  â€¢ Unified interface for all three curves                   â”‚
â”‚  â€¢ Parallel derivation for preview                          â”‚
â”‚  â€¢ Type-safe curve selection                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOT.Polkadot â”‚  â”‚ DOT.Polkadot â”‚  â”‚ DOT.Polkadot â”‚
â”‚ .ed25519.ts  â”‚  â”‚ .sr25519.ts  â”‚  â”‚ .ecdsa.ts    â”‚
â”‚  (Existing)  â”‚  â”‚  (Existing)  â”‚  â”‚    (NEW)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow

```typescript
// User inputs private key
privateKey: string â†’ 

// CurveSelector provides curve choice
selectedCurve: 'ed25519' | 'sr25519' | 'ecdsa' â†’

// Parallel derivation for preview (optional)
[
  deriveEd25519(privateKey),
  deriveSr25519(privateKey),
  deriveEcdsa(privateKey)
] â†’

// User confirms selection
selectedResult: AddressData â†’

// Final submission
onSubmit(selectedResult)
```

---

## Implementation Plan

### Phase 1: Backend Implementation (Core Logic)

#### 1.1 Create Unified Curve Interface

**File:** `ext.DOT.Polkadot/DOT.Polkadot.CurveSelector.ts`

```typescript
// New file to unify curve selection logic
import { polkadotEd25519Data } from './DOT.Polkadot.ed25519';
import { polkadotSr25519Data } from './DOT.Polkadot.sr25519';
// import { polkadotEcdsaData } from './DOT.Polkadot.ecdsa'; // To be created

export type PolkadotCurve = 'ed25519' | 'sr25519' | 'ecdsa';

export interface CurveDerivedResult {
  curve: PolkadotCurve;
  publicKey: string;
  polkadotAddress: string;
  kusamaAddress: string;
  substrateAddress: string;
}

export interface CurveMetadata {
  name: string;
  displayName: string;
  description: string;
  useCases: string[];
  compatibleWith: string[];
  isDefault: boolean;
}

export const CURVE_METADATA: Record<PolkadotCurve, CurveMetadata> = {
  ed25519: {
    name: 'ed25519',
    displayName: 'Ed25519 (Edwards-curve)',
    description: 'Used by Exodus wallet for raw private key imports',
    useCases: [
      'Exodus wallet private keys',
      'Direct key imports',
      'Simple wallet operations'
    ],
    compatibleWith: ['Exodus', 'Some Polkadot.js exports'],
    isDefault: false
  },
  sr25519: {
    name: 'sr25519',
    displayName: 'Sr25519 (Schnorrkel)',
    description: 'Standard Polkadot signature scheme, used by most wallets',
    useCases: [
      'Polkadot.js wallet keystores',
      'Talisman wallet',
      'SubWallet',
      'Standard derivation paths'
    ],
    compatibleWith: ['Polkadot.js', 'Talisman', 'SubWallet', 'Nova Spektr'],
    isDefault: true // Most common
  },
  ecdsa: {
    name: 'ecdsa',
    displayName: 'ECDSA (secp256k1)',
    description: 'Ethereum-compatible curve, used for cross-chain operations',
    useCases: [
      'Ethereum compatibility',
      'Cross-chain operations',
      'Some parachains'
    ],
    compatibleWith: ['MetaMask-style wallets', 'Ethereum tools'],
    isDefault: false
  }
};

/**
 * Derive addresses using all three curves in parallel
 * Useful for preview functionality
 */
export async function deriveAllCurves(
  privateKey: string
): Promise<Record<PolkadotCurve, CurveDerivedResult>> {
  console.log('ğŸ”„ [CURVE SELECTOR] Deriving addresses for all curves...');

  const [ed25519Result, sr25519Result] = await Promise.all([
    polkadotEd25519Data.deriveFromPrivateKey(privateKey),
    polkadotSr25519Data.deriveFromPrivateKey(privateKey),
    // polkadotEcdsaData.deriveFromPrivateKey(privateKey), // Phase 2
  ]);

  return {
    ed25519: {
      curve: 'ed25519',
      ...ed25519Result
    },
    sr25519: {
      curve: 'sr25519',
      ...sr25519Result
    },
    ecdsa: {
      curve: 'ecdsa',
      publicKey: 'Not yet implemented',
      polkadotAddress: 'Not yet implemented',
      kusamaAddress: 'Not yet implemented',
      substrateAddress: 'Not yet implemented'
    }
  };
}

/**
 * Derive address using specific curve
 */
export async function deriveWithCurve(
  privateKey: string,
  curve: PolkadotCurve
): Promise<CurveDerivedResult> {
  console.log(`ğŸ”„ [CURVE SELECTOR] Deriving with ${curve}...`);

  switch (curve) {
    case 'ed25519': {
      const result = await polkadotEd25519Data.deriveFromPrivateKey(privateKey);
      return { curve: 'ed25519', ...result };
    }
    case 'sr25519': {
      const result = await polkadotSr25519Data.deriveFromPrivateKey(privateKey);
      return { curve: 'sr25519', ...result };
    }
    case 'ecdsa':
      throw new Error('ECDSA curve not yet implemented');
    default:
      throw new Error(`Unknown curve: ${curve}`);
  }
}

/**
 * Get recommended curve based on context
 */
export function getRecommendedCurve(context: {
  isKeystorePublicKey?: boolean;
  sourceWallet?: string;
  userPreference?: PolkadotCurve;
}): PolkadotCurve {
  // User preference always wins
  if (context.userPreference) {
    return context.userPreference;
  }

  // Keystore public keys should use sr25519
  if (context.isKeystorePublicKey) {
    return 'sr25519';
  }

  // Wallet-specific recommendations
  if (context.sourceWallet) {
    const wallet = context.sourceWallet.toLowerCase();
    if (wallet.includes('exodus')) return 'ed25519';
    if (wallet.includes('polkadot')) return 'sr25519';
    if (wallet.includes('talisman')) return 'sr25519';
    if (wallet.includes('subwallet')) return 'sr25519';
  }

  // Default: sr25519 (most common)
  return 'sr25519';
}
```

#### 1.2 Create ECDSA Implementation

**File:** `ext.DOT.Polkadot/DOT.Polkadot.ecdsa.ts`

```typescript
// New file for ECDSA curve support
import { cryptoWaitReady } from '@polkadot/util-crypto';
import { Keyring } from '@polkadot/keyring';
import { u8aToHex, hexToU8a } from '@polkadot/util';

export const polkadotEcdsaData = {
  async deriveFromPrivateKey(privateKey: string) {
    await cryptoWaitReady();
    
    const keyring = new Keyring({ type: 'ecdsa' });
    const cleanKey = privateKey.startsWith('0x') ? privateKey.slice(2) : privateKey;
    const privateKeyBytes = hexToU8a(`0x${cleanKey}`);
    
    const pair = keyring.addFromSeed(privateKeyBytes);
    
    return {
      publicKey: u8aToHex(pair.publicKey),
      polkadotAddress: keyring.encodeAddress(pair.publicKey, 0),
      kusamaAddress: keyring.encodeAddress(pair.publicKey, 2),
      substrateAddress: keyring.encodeAddress(pair.publicKey, 42)
    };
  }
};
```

#### 1.3 Update Router Logic

**File:** `ext.DOT.Polkadot/router.DOT.Polkadot.ts`

```typescript
// Add curve parameter support
import { PolkadotCurve, deriveWithCurve } from './DOT.Polkadot.CurveSelector';

/**
 * Routes private key derivation with explicit curve selection
 */
export async function routePrivateKeyDerivationWithCurve(
  privateKey: string,
  curve: PolkadotCurve
) {
  try {
    console.log(`ğŸ”§ [ROUTER] Explicit curve routing: ${curve}`);

    const cleanPrivateKey = privateKey.startsWith('0x') 
      ? privateKey.slice(2) 
      : privateKey;
    
    if (cleanPrivateKey.length !== 64) {
      throw new Error(`Invalid key length: expected 64 hex characters`);
    }

    return await deriveWithCurve(cleanPrivateKey, curve);

  } catch (error) {
    console.error('[ROUTER] Curve-specific derivation error:', error);
    throw new Error(`Polkadot ${curve} derivation failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
  }
}

// Keep existing automatic routing for backward compatibility
export async function routePrivateKeyDerivation(privateKey: string) {
  // Existing implementation...
}
```

### Phase 2: Frontend Implementation (UI Components)

#### 2.1 Create CurveSelector Component

**File:** `components/global/privateKeyManagement/CurveSelector.tsx`

```typescript
import { useState } from 'react';
import { Label } from '@/components/ui/label';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Info } from 'lucide-react';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import { CURVE_METADATA, type PolkadotCurve } from '@/components/currencies/ext.DOT.Polkadot/DOT.Polkadot.CurveSelector';

interface CurveSelectorProps {
  value: PolkadotCurve;
  onChange: (curve: PolkadotCurve) => void;
  disabled?: boolean;
}

export const CurveSelector = ({
  value,
  onChange,
  disabled = false
}: CurveSelectorProps) => {
  const curves: PolkadotCurve[] = ['sr25519', 'ed25519', 'ecdsa'];

  return (
    <div className="space-y-3">
      <Label className="text-sm font-medium">
        Cryptographic Curve
        <TooltipProvider>
          <Tooltip>
            <TooltipTrigger asChild>
              <Info className="inline-block ml-2 w-4 h-4 cursor-help" />
            </TooltipTrigger>
            <TooltipContent className="max-w-sm">
              <p className="font-semibold mb-2">Why does this matter?</p>
              <p className="text-sm">
                The same private key produces different addresses when derived 
                using different cryptographic curves. Choose the curve that 
                matches your original wallet.
              </p>
            </TooltipContent>
          </Tooltip>
        </TooltipProvider>
      </Label>

      <RadioGroup
        value={value}
        onValueChange={(v) => onChange(v as PolkadotCurve)}
        disabled={disabled}
        className="space-y-2"
      >
        {curves.map((curve) => {
          const metadata = CURVE_METADATA[curve];
          return (
            <div
              key={curve}
              className={`flex items-start space-x-3 border rounded-lg p-3 ${
                value === curve ? 'border-primary bg-primary/5' : 'border-gray-200'
              } ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}
              onClick={() => !disabled && onChange(curve)}
            >
              <RadioGroupItem value={curve} id={curve} />
              <div className="flex-1">
                <Label
                  htmlFor={curve}
                  className={`font-medium cursor-pointer ${
                    metadata.isDefault ? 'text-primary' : ''
                  }`}
                >
                  {metadata.displayName}
                  {metadata.isDefault && (
                    <span className="ml-2 text-xs bg-primary/20 px-2 py-0.5 rounded">
                      Recommended
                    </span>
                  )}
                </Label>
                <p className="text-sm text-gray-600 mt-1">
                  {metadata.description}
                </p>
                <p className="text-xs text-gray-500 mt-1">
                  <strong>Compatible with:</strong> {metadata.compatibleWith.join(', ')}
                </p>
              </div>
            </div>
          );
        })}
      </RadioGroup>
    </div>
  );
};
```

#### 2.2 Create AddressPreview Component

**File:** `components/global/privateKeyManagement/AddressPreview.tsx`

```typescript
import { useState, useEffect } from 'react';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Copy, ChevronDown, ChevronUp } from 'lucide-react';
import { toast } from 'sonner';
import { deriveAllCurves, type CurveDerivedResult, type PolkadotCurve } from '@/components/currencies/ext.DOT.Polkadot/DOT.Polkadot.CurveSelector';

interface AddressPreviewProps {
  privateKey: string;
  selectedCurve: PolkadotCurve;
  network: 'polkadot' | 'kusama' | 'substrate';
}

export const AddressPreview = ({
  privateKey,
  selectedCurve,
  network = 'polkadot'
}: AddressPreviewProps) => {
  const [results, setResults] = useState<Record<PolkadotCurve, CurveDerivedResult> | null>(null);
  const [loading, setLoading] = useState(false);
  const [showAllCurves, setShowAllCurves] = useState(false);

  useEffect(() => {
    if (!privateKey || privateKey.length !== 64) {
      setResults(null);
      return;
    }

    const deriveAddresses = async () => {
      setLoading(true);
      try {
        const allResults = await deriveAllCurves(privateKey);
        setResults(allResults);
      } catch (error) {
        console.error('Derivation error:', error);
        toast.error('Failed to derive addresses');
      } finally {
        setLoading(false);
      }
    };

    deriveAddresses();
  }, [privateKey]);

  const getAddressForNetwork = (result: CurveDerivedResult) => {
    switch (network) {
      case 'polkadot': return result.polkadotAddress;
      case 'kusama': return result.kusamaAddress;
      case 'substrate': return result.substrateAddress;
    }
  };

  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text);
    toast.success('Address copied to clipboard');
  };

  if (!privateKey || privateKey.length !== 64) {
    return (
      <div className="text-sm text-gray-500 p-3 border rounded-lg">
        Enter a valid 64-character private key to preview addresses
      </div>
    );
  }

  if (loading) {
    return (
      <div className="text-sm text-gray-500 p-3 border rounded-lg">
        Deriving addresses...
      </div>
    );
  }

  if (!results) return null;

  const selectedResult = results[selectedCurve];
  const selectedAddress = getAddressForNetwork(selectedResult);

  return (
    <div className="space-y-3">
      <Label className="text-sm font-medium">Address Preview</Label>
      
      {/* Selected Curve Preview */}
      <div className="border rounded-lg p-3 bg-primary/5 border-primary">
        <div className="flex items-center justify-between mb-2">
          <span className="text-xs font-medium text-gray-600">
            {selectedCurve.toUpperCase()} Address ({network})
          </span>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => copyToClipboard(selectedAddress)}
          >
            <Copy className="w-4 h-4" />
          </Button>
        </div>
        <code className="text-xs break-all block">
          {selectedAddress}
        </code>
      </div>

      {/* Show All Curves Toggle */}
      <Button
        variant="outline"
        size="sm"
        onClick={() => setShowAllCurves(!showAllCurves)}
        className="w-full"
      >
        {showAllCurves ? (
          <>
            <ChevronUp className="w-4 h-4 mr-2" />
            Hide Other Curves
          </>
        ) : (
          <>
            <ChevronDown className="w-4 h-4 mr-2" />
            Show All Curves
          </>
        )}
      </Button>

      {/* All Curves Preview */}
      {showAllCurves && (
        <div className="space-y-2">
          {(['ed25519', 'sr25519', 'ecdsa'] as PolkadotCurve[]).map((curve) => {
            if (curve === selectedCurve) return null;
            const result = results[curve];
            const address = getAddressForNetwork(result);
            
            return (
              <div key={curve} className="border rounded-lg p-3">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-xs font-medium text-gray-600">
                    {curve.toUpperCase()}
                  </span>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => copyToClipboard(address)}
                  >
                    <Copy className="w-4 h-4" />
                  </Button>
                </div>
                <code className="text-xs break-all block text-gray-500">
                  {address}
                </code>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
};
```

#### 2.3 Update Importing Component

**File:** `components/global/privateKeyManagement/Importing.tsx`

```typescript
// Add curve selection support
import { CurveSelector } from './CurveSelector';
import { AddressPreview } from './AddressPreview';
import { type PolkadotCurve } from '@/components/currencies/ext.DOT.Polkadot/DOT.Polkadot.CurveSelector';

interface ImportingProps {
  // ... existing props
  showCurveSelector?: boolean; // NEW: Show curve selector for Polkadot
  selectedCurve?: PolkadotCurve; // NEW: Current curve selection
  onCurveChange?: (curve: PolkadotCurve) => void; // NEW: Curve change handler
  showAddressPreview?: boolean; // NEW: Show address preview
}

export const Importing = ({
  // ... existing props
  showCurveSelector = false,
  selectedCurve = 'sr25519',
  onCurveChange,
  showAddressPreview = false
}: ImportingProps) => {
  // ... existing code

  return (
    <>
      <div>
        <Label className="mb-2 block">{label}</Label>
        
        {/* Existing input field */}
        <div className="flex gap-2">
          {/* ... existing input code ... */}
        </div>

        {/* NEW: Curve Selector (for Polkadot imports) */}
        {showCurveSelector && onCurveChange && (
          <div className="mt-4">
            <CurveSelector
              value={selectedCurve}
              onChange={onCurveChange}
              disabled={!value.trim()}
            />
          </div>
        )}

        {/* NEW: Address Preview (for Polkadot imports) */}
        {showAddressPreview && value.trim().length === 64 && (
          <div className="mt-4">
            <AddressPreview
              privateKey={value}
              selectedCurve={selectedCurve}
              network="polkadot"
            />
          </div>
        )}
      </div>

      {/* ... existing password dialog ... */}
    </>
  );
};
```

### Phase 3: Integration & Testing

#### 3.1 Update Polkadot Import Page

**File:** `pages/polkadot/import.tsx` (or equivalent)

```typescript
import { useState } from 'react';
import { Importing } from '@/components/global/privateKeyManagement/Importing';
import { routePrivateKeyDerivationWithCurve } from '@/components/currencies/ext.DOT.Polkadot/router.DOT.Polkadot';
import { type PolkadotCurve } from '@/components/currencies/ext.DOT.Polkadot/DOT.Polkadot.CurveSelector';

export const PolkadotImportPage = () => {
  const [privateKey, setPrivateKey] = useState('');
  const [selectedCurve, setSelectedCurve] = useState<PolkadotCurve>('sr25519');

  const handleImport = async () => {
    try {
      const result = await routePrivateKeyDerivationWithCurve(
        privateKey,
        selectedCurve
      );
      
      console.log('Import successful:', result);
      // Handle successful import...
    } catch (error) {
      console.error('Import failed:', error);
      // Handle error...
    }
  };

  return (
    <div className="space-y-6">
      <h1>Import Polkadot Private Key</h1>
      
      <Importing
        label="Private Key"
        placeholder="Enter 64-character hex private key"
        value={privateKey}
        onChange={setPrivateKey}
        onSubmit={handleImport}
        submitLabel="Import"
        showCurveSelector={true}
        selectedCurve={selectedCurve}
        onCurveChange={setSelectedCurve}
        showAddressPreview={true}
      />
    </div>
  );
};
```

---

## Testing Strategy

### Unit Tests

```typescript
// tests/ext.DOT.Polkadot/CurveSelector.test.ts

import { deriveAllCurves, deriveWithCurve, getRecommendedCurve } from '../DOT.Polkadot.CurveSelector';

describe('CurveSelector', () => {
  const TEST_PRIVATE_KEY = '3726aca4a2ea17a636741a8094b78356eed4f14be9de2d82bccb4f9e05119073';

  describe('deriveAllCurves', () => {
    it('should derive addresses for all curves', async () => {
      const results = await deriveAllCurves(TEST_PRIVATE_KEY);
      
      expect(results).toHaveProperty('ed25519');
      expect(results).toHaveProperty('sr25519');
      expect(results).toHaveProperty('ecdsa');
      
      // Verify ed25519 matches known Exodus output
      expect(results.ed25519.polkadotAddress).toBe(
        '138L1m4rgDPgneujUrntWCtibXgjMxjZMv9NL8HQKeEedUWb'
      );
    });
  });

  describe('deriveWithCurve', () => {
    it('should derive ed25519 correctly', async () => {
      const result = await deriveWithCurve(TEST_PRIVATE_KEY, 'ed25519');
      expect(result.curve).toBe('ed25519');
      expect(result.polkadotAddress).toBe(
        '138L1m4rgDPgneujUrntWCtibXgjMxjZMv9NL8HQKeEedUWb'
      );
    });

    it('should derive sr25519 correctly', async () => {
      const result = await deriveWithCurve(TEST_PRIVATE_KEY, 'sr25519');
      expect(result.curve).toBe('sr25519');
      expect(result.polkadotAddress).toBeTruthy();
      expect(result.polkadotAddress).not.toBe(
        '138L1m4rgDPgneujUrntWCtibXgjMxjZMv9NL8HQKeEedUWb'
      );
    });
  });

  describe('getRecommendedCurve', () => {
    it('should recommend ed25519 for Exodus', () => {
      const curve = getRecommendedCurve({ sourceWallet: 'Exodus' });
      expect(curve).toBe('ed25519');
    });

    it('should recommend sr25519 for Polkadot.js', () => {
      const curve = getRecommendedCurve({ sourceWallet: 'Polkadot.js' });
      expect(curve).toBe('sr25519');
    });

    it('should respect user preference', () => {
      const curve = getRecommendedCurve({ 
        sourceWallet: 'Exodus',
        userPreference: 'ecdsa'
      });
      expect(curve).toBe('ecdsa');
    });
  });
});
```

### Integration Tests

```typescript
// tests/integration/polkadot-import.test.tsx

import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { PolkadotImportPage } from '../pages/polkadot/import';

describe('Polkadot Import Integration', () => {
  it('should show address preview when private key is entered', async () => {
    render(<PolkadotImportPage />);
    
    const input = screen.getByPlaceholderText(/private key/i);
    fireEvent.change(input, {
      target: { value: '3726aca4a2ea17a636741a8094b78356eed4f14be9de2d82bccb4f9e05119073' }
    });

    await waitFor(() => {
      expect(screen.getByText(/Address Preview/i)).toBeInTheDocument();
    });
  });

  it('should change address when curve selection changes', async () => {
    render(<PolkadotImportPage />);
    
    const input = screen.getByPlaceholderText(/private key/i);
    fireEvent.change(input, {
      target: { value: '3726aca4a2ea17a636741a8094b78356eed4f14be9de2d82bccb4f9e05119073' }
    });

    // Select ed25519
    const ed25519Radio = screen.getByLabelText(/Ed25519/i);
    fireEvent.click(ed25519Radio);

    await waitFor(() => {
      expect(screen.getByText(/138L1m4rgDP/)).toBeInTheDocument();
    });

    // Select sr25519
    const sr25519Radio = screen.getByLabelText(/Sr25519/i);
    fireEvent.click(sr25519Radio);

    await waitFor(() => {
      expect(screen.queryByText(/138L1m4rgDP/)).not.toBeInTheDocument();
    });
  });
});
```

---

## User Experience Design

### UI/UX Principles

1. **Progressive Disclosure**
   - Show curve selector only for Polkadot imports
   - Hide complexity for users who don't need it
   - Expand/collapse detailed information

2. **Clear Guidance**
   - Tooltips explaining what curves are
   - Wallet-specific recommendations
   - Visual indicators for default/recommended options

3. **Immediate Feedback**
   - Real-time address preview
   - Show addresses for all curves on demand
   - Copy-to-clipboard functionality

4. **Error Prevention**
   - Disable submit until valid input
   - Show validation errors inline
   - Prevent common mistakes with guidance

### User Flows

#### Flow 1: Exodus User (ed25519)

```
1. User enters Exodus private key
   â””â”€> System detects 64-char hex
   
2. Curve selector appears
   â””â”€> Shows ed25519 option with "Compatible with: Exodus" label
   
3. User selects ed25519
   â””â”€> Address preview shows correct Exodus address
   
4. User verifies address matches their Exodus wallet
   â””â”€> Clicks "Import"
   
5. Success!
```

#### Flow 2: Polkadot.js User (sr25519)

```
1. User uploads .json keystore
   â””â”€> System prompts for password
   
2. Keystore decrypted
   â””â”€> Curve selector shows sr25519 pre-selected (recommended)
   
3. Address preview shows expected address
   â””â”€> User recognizes their Polkadot.js address
   
4. User clicks "Import"
   
5. Success!
```

#### Flow 3: Uncertain User

```
1. User enters private key
   â””â”€> Curve selector appears
   
2. User doesn't know which curve
   â””â”€> Clicks "Show All Curves"
   
3. System shows addresses for all three curves
   â””â”€> User compares with their known address
   
4. User selects matching curve
   â””â”€> Clicks "Import"
   
5. Success!
```

### Visual Design Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Import Polkadot Private Key                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Private Key                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ 3726aca4a2ea17a636741a8094b78356eed4f14be9de2... â”‚ ğŸ“  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  Cryptographic Curve â„¹ï¸                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‰ Sr25519 (Schnorrkel)          [Recommended]      â”‚   â”‚
â”‚  â”‚   Standard Polkadot signature scheme, used by...   â”‚   â”‚
â”‚  â”‚   Compatible with: Polkadot.js, Talisman, SubWalletâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ Ed25519 (Edwards-curve)                          â”‚   â”‚
â”‚  â”‚   Used by Exodus wallet for raw private key...     â”‚   â”‚
â”‚  â”‚   Compatible with: Exodus, Some Polkadot.js...     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ ECDSA (secp256k1)                                â”‚   â”‚
â”‚  â”‚   Ethereum-compatible curve, used for cross-chain  â”‚   â”‚
â”‚  â”‚   Compatible with: MetaMask-style wallets          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Address Preview                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SR25519 Address (polkadot)                    ğŸ“‹   â”‚   â”‚
â”‚  â”‚ 15FychzvJniBBRUF4299btNXoQkgaAnZBfNstxiDHp5hXaip  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚ â–¼ Show All Curves â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                             â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                              â”‚ Import Wallet  â”‚            â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Considerations

### Input Validation

```typescript
// Validate private key before derivation
function validatePrivateKey(input: string): { valid: boolean; error?: string } {
  const cleanInput = input.startsWith('0x') ? input.slice(2) : input;
  
  if (cleanInput.length !== 64) {
    return {
      valid: false,
      error: 'Private key must be exactly 64 hexadecimal characters'
    };
  }
  
  if (!/^[0-9a-fA-F]+$/.test(cleanInput)) {
    return {
      valid: false,
      error: 'Private key must contain only hexadecimal characters (0-9, a-f)'
    };
  }
  
  return { valid: true };
}
```

### Secure Key Handling

1. **Never Log Private Keys**
   ```typescript
   // âŒ NEVER do this
   console.log('Private key:', privateKey);
   
   // âœ… Safe logging
   console.log('Private key length:', privateKey.length);
   console.log('Private key preview:', privateKey.substring(0, 4) + '...');
   ```

2. **Clear Sensitive Data**
   ```typescript
   useEffect(() => {
     return () => {
       // Clear private key from memory on unmount
       setPrivateKey('');
     };
   }, []);
   ```

3. **Secure Storage**
   ```typescript
   // Never store raw private keys in localStorage
   // Always encrypt before storage
   const encryptedKey = await encryptPrivateKey(privateKey, userPassword);
   secureStorage.set('wallet_key', encryptedKey);
   ```

### User Warnings

```typescript
// Show warning when switching curves
const showCurveChangeWarning = () => {
  return (
    <Alert variant="warning">
      <AlertTitle>Warning: Changing Curve</AlertTitle>
      <AlertDescription>
        Changing the cryptographic curve will generate a different address.
        Make sure you select the curve that matches your original wallet.
        <br /><br />
        <strong>If you're not sure, compare the generated addresses 
        with your known wallet address.</strong>
      </AlertDescription>
    </Alert>
  );
};
```

---

## References

### Documentation

1. **Analysis Documents:**
   - `10012025.loginStandard.Exodus.polkadot.implementation.analysis.md`
   - `10012025.loginStandard.Polkadot.addressGeneration.discrepancy.analysis.md`
   - `10012025.loginStandard.Polkadot.wallet.implementations.analysis.md`

2. **Source Implementations:**
   - Talisman: `wallets.sourceCode.Polkadot/talisman-dev/packages/crypto/src/derivation/`
   - SubWallet: `wallets.sourceCode.Polkadot/SubWallet-Extension-master/packages/extension-base/`
   - Nova Spektr: `wallets.sourceCode.Polkadot/nova-spektr-dev/src/renderer/entities/wallet/`

3. **Current Implementation:**
   - `src/components/currencies/ext.DOT.Polkadot/router.DOT.Polkadot.ts`
   - `src/components/currencies/ext.DOT.Polkadot/DOT.Polkadot.ed25519.ts`
   - `src/components/currencies/ext.DOT.Polkadot/DOT.Polkadot.sr25519.ts`

### External Resources

- [Polkadot.js Documentation](https://polkadot.js.org/docs/)
- [Substrate Address Format](https://docs.substrate.io/reference/address-formats/)
- [Ed25519 Specification](https://ed25519.cr.yp.to/)
- [Sr25519 Specification](https://wiki.polkadot.network/docs/learn-cryptography)

---

## Appendix: Implementation Checklist

### Phase 1: Backend âœ…
- [ ] Create `DOT.Polkadot.CurveSelector.ts`
- [ ] Implement `deriveAllCurves()` function
- [ ] Implement `deriveWithCurve()` function
- [ ] Implement `getRecommendedCurve()` function
- [ ] Create `DOT.Polkadot.ecdsa.ts`
- [ ] Update `router.DOT.Polkadot.ts` with curve parameter
- [ ] Add comprehensive unit tests

### Phase 2: Frontend âœ…
- [ ] Create `CurveSelector.tsx` component
- [ ] Create `AddressPreview.tsx` component
- [ ] Update `Importing.tsx` with curve selector support
- [ ] Add tooltip components and guidance
- [ ] Implement copy-to-clipboard functionality
- [ ] Add responsive design for mobile

### Phase 3: Integration âœ…
- [ ] Update Polkadot import page
- [ ] Add integration tests
- [ ] Test all three curves with known test vectors
- [ ] Validate against Exodus wallet
- [ ] Validate against Polkadot.js wallet
- [ ] User acceptance testing

### Phase 4: Documentation âœ…
- [ ] Update README.md in `ext.DOT.Polkadot/`
- [ ] Add usage examples
- [ ] Document curve selection guidelines
- [ ] Create troubleshooting guide
- [ ] Add security best practices

---

**Document Version:** 1.0  
**Last Updated:** October 1, 2025  
**Status:** ğŸ“‹ **Ready for Implementation**

