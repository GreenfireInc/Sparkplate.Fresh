# Progress Report: Terra Classic Bech32 Import Fix

**Date:** September 2, 2025
**Feature:** Terra Classic Bech32 Import Syntax Fix
**Status:** Completed

## Overview

Fixed the Terra Classic (LUNC) private key derivation implementation by correcting the bech32 library import syntax. The issue was similar to previous library import problems where the functions needed to be accessed through the correct namespace.

## Technical Issue

### Root Cause
The error `TypeError: bech32.toWords is not a function` was caused by incorrect import syntax for the bech32 library. The library exports its functions in a way that requires accessing them through the `bech32.bech32` namespace.

### Original Problem
```typescript
const bech32 = await import('bech32');
const words = bech32.toWords(hash2);  // ❌ This was failing
const address = bech32.encode(TERRA_BECH32_PREFIX, words);  // ❌ This was failing
```

### Solution Applied
```typescript
const bech32 = await import('bech32');
const words = bech32.bech32.toWords(hash2);  // ✅ Fixed
const address = bech32.bech32.encode(TERRA_BECH32_PREFIX, words);  // ✅ Fixed
```

## Implementation Details

### Bech32 Library Structure
The bech32 library version 2.0.0 exports its functions through a nested structure:
- `bech32.bech32.toWords()` - Converts bytes to 5-bit words
- `bech32.bech32.encode()` - Encodes with Bech32 format
- `bech32.bech32m` - Alternative encoding for newer applications

### Terra Classic Address Generation
The fix maintains the complete Terra Classic address derivation process:
1. Private key (32 bytes) → Public key (33 bytes, compressed)
2. SHA-256 hash → RIPEMD-160 hash
3. Convert to 5-bit words → Bech32 encode with "terra" prefix

## Testing

- Created verification test script to confirm the fix works
- Validates proper Terra Classic address format (terra1...)
- Confirms correct address length and structure
- Tests both compressed and uncompressed public key generation

## Dependencies

- `bech32: ^2.0.0` - Bech32 encoding library (unchanged)
- All other dependencies remain the same

## Impact

This fix resolves the runtime error that was preventing Terra Classic private key derivation from working in the TemporaryKeyModal component. Users can now successfully derive Terra Classic addresses from private keys.

## Notes

The bech32 library follows a similar export pattern to other cryptographic libraries in the project. This fix aligns the Terra Classic implementation with the same import patterns used in other cryptocurrency modules.
