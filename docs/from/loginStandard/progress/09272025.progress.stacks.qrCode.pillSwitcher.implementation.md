# Stacks QR Code Pill Switcher Implementation
**Date:** September 27, 2025
**Author:** System Assistant
**Task:** Implement pill switcher for Stacks multi-network address display

## Overview
This report documents the implementation of pill switcher functionality for Stacks addresses, extending the multi-format address support to include all major Stacks network variants: Mainnet, Testnet, Native SegWit (Bitcoin), and Taproot (Bitcoin). This follows the same pattern established for Polkadot, Litecoin, and Bitcoin.

## Problem Statement
Stacks supports multiple network environments and cross-chain Bitcoin addresses that provide different benefits and use cases:
- **Mainnet**: Production Stacks network, starts with "SP" or "SM", primary production environment
- **Testnet**: Development Stacks network, starts with "ST" or "SN", for testing and development
- **Native SegWit**: Bitcoin Native SegWit address (bc1q), optimal fees for BTC transactions
- **Taproot**: Bitcoin Taproot address (bc1p), latest privacy and efficiency features

Previously, users could only generate one primary address format at a time, with additional addresses stored in pipe-separated format fields. The implementation adds the ability to switch between all four address types using a pill switcher.

## Solution Implemented

### 1. Enhanced Stacks Router Multi-Format Support
**Location:** `src/components/currencies/STX.Stacks.ts`
**Date:** September 27, 2025

**Key Changes:**
- ‚úÖ **Multi-Format Generation**: Modified router to generate all four address formats simultaneously
- ‚úÖ **Parallel Processing**: All address types generated concurrently for optimal performance
- ‚úÖ **Comprehensive Logging**: Added detailed console logging for debugging and verification
- ‚úÖ **Proper HD Derivation**: Separate derivation paths for Stacks vs Bitcoin addresses when using seed phrases

**Implementation:**
```typescript
// Multi-format mode: Generate all address formats
const formattedDisplay = `Mainnet://${mainnetAddress}\nTestnet://${testnetAddress}\nNativeSegwit://${btcNativeSegwitAddress}\nTaproot://${btcTaprootAddress}`;
```

**HD Derivation Logic:**
- **Stacks**: `m/44'/5757'/0'/0/0` (proper Stacks derivation path)
- **BTC Native SegWit**: `m/84'/0'/0'/0/0` (BIP84 standard)
- **BTC Taproot**: `m/86'/0'/0'/0/0` (BIP86 standard)

### 2. Extended DerivedInfo Interface
**Location:** `src/components/currencies/currencyData.ts`
**Date:** September 27, 2025

**Added Properties:**
- ‚úÖ **`mainnetAddress`**, **`testnetAddress`**: Stacks network addresses
- ‚úÖ **`nativeSegwitAddress`**, **`taprootAddress`**: Bitcoin cross-chain addresses
- ‚úÖ **Backward Compatibility**: `rawMainnetAddress`, `rawTestnetAddress`, etc.

### 3. TemporaryKeyModal Stacks Integration
**Location:** `src/components/accessControl/authentication/loginStandard/options/TemporaryKeyModal.tsx`
**Date:** September 27, 2025

**Key Features:**
- ‚úÖ **Pill Switcher Support**: Added STX to existing DOT/LTC/BTC pill switcher logic
- ‚úÖ **Conditional Rendering**: Extended address display logic to handle STX formats
- ‚úÖ **Smart Copy Button**: Updated copy logic to handle STX network selection
- ‚úÖ **Fallback Display**: Shows all formats when no selection is made

**Integration Logic:**
```typescript
// Support DOT, LTC, BTC, and STX multi-format addresses
{(ticker === "DOT" || ticker === "LTC" || ticker === "BTC" || ticker === "STX") && derived.formattedDisplay && (
  <QrCodeMultFormatAddressDisplay
    formattedDisplay={derived.formattedDisplay}
    onAddressChange={handleAddressChange}
  />
)}
```

## User Experience Improvements

### Before Implementation:
```
[QR Code - only mainnet]
Address: SP2J6ZY48GV1EZ5V2V5RB9MP66SW86PYKKNRV9EJ7
[Copy Button]
```
*Users had limited access to testnet and Bitcoin addresses*

### After Implementation:
```
[QR Code - switches dynamically]
[Mainnet] [Testnet] [NativeSegwit] [Taproot] ‚Üê Pill buttons
Mainnet://SP2J6ZY48GV1EZ5V2V5RB9MP66SW86PYKKNRV9EJ7    ‚Üê Selected network shown
[Smart Copy Button] ‚Üê Copies selected address
```

### Benefits:
- **üåê Network Flexibility**: Instant switching between Stacks mainnet/testnet environments
- **‚Çø Cross-Chain Access**: Direct access to Bitcoin Native SegWit and Taproot addresses
- **üîÑ Dynamic Updates**: Address display and QR code adapt to selection
- **üß™ Development Support**: Easy access to testnet for development and testing
- **üí∞ Fee Optimization**: Choose between different Bitcoin address formats for optimal fees

## Technical Implementation Details

### Address Format Details:
- **Mainnet**: C32Check encoding, starts with "SP" (single sig) or "SM" (multi-sig)
- **Testnet**: C32Check encoding, starts with "ST" (single sig) or "SN" (multi-sig)
- **Native SegWit**: Bech32, starts with "bc1q", optimal fees for BTC transactions
- **Taproot**: Bech32m, starts with "bc1p", latest privacy and efficiency features

### HD Derivation Details:
- **Seed Phrase Support**: 24-word BIP39 seed phrases properly derive all address types
- **Separate Derivations**: Stacks and Bitcoin addresses use appropriate derivation paths
- **Legacy Compatibility**: Direct private keys still work (same key for all formats)

### State Management:
- **Selection Tracking**: `selectedNetwork` state tracks current format (Mainnet/Testnet/NativeSegwit/Taproot)
- **QR Code Updates**: `qrCodeAddress` updates dynamically on network changes
- **Copy Intelligence**: Copy button copies selected network address
- **Link Behavior**: Opens appropriate block explorer for selected address

## Testing & Validation
- ‚úÖ **TypeScript Compilation**: Clean compilation with extended interfaces
- ‚úÖ **Address Generation**: All four formats generate correctly and uniquely
- ‚úÖ **HD Derivation**: Proper seed phrase support with correct derivation paths
- ‚úÖ **QR Code Scanning**: All formats produce scannable QR codes
- ‚úÖ **Pill Switching**: Smooth transitions between network formats
- ‚úÖ **Copy Functionality**: Copy button works for selected network address
- ‚úÖ **Legacy Compatibility**: Existing direct private key functionality preserved

## Files Modified
1. `src/components/currencies/STX.Stacks.ts` - Multi-format address generation
2. `src/components/currencies/currencyData.ts` - Extended DerivedInfo interface
3. `src/components/accessControl/authentication/loginStandard/options/TemporaryKeyModal.tsx` - UI integration

## Impact
This implementation provides Stacks users with comprehensive network and cross-chain address flexibility, allowing them to easily switch between Stacks mainnet/testnet environments and access Bitcoin Native SegWit/Taproot addresses for optimal transaction efficiency. The implementation establishes a complete multi-network ecosystem for Stacks users while maintaining backward compatibility and following established design patterns.

The pill switcher now supports four major cryptocurrencies (DOT, LTC, BTC, STX) with their complete multi-format address systems, creating a unified and powerful user experience across different blockchain ecosystems.
